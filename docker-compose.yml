# ~/streamcache/docker-compose.yml
services:
  streamcache:
    build: .
    image: streamcache:latest
    container_name: streamcache
    ports:
      - "8080:8080"
    restart: unless-stopped
    environment:
      CACHE_MAX_BYTES: "536870912000"        # 500 GB
      CACHE_LOW_WATERMARK_BYTES: "483183820800"  # 450 GB
      RANGE_TEE_THRESHOLD: "1048576"   # 1 MiB near-start window
      PROGRESS_FLUSH_BYTES: "262144"   # writer flush/report cadence
      FOLLOWER_WAIT_MAX: "60"          # seconds the follower will wait for bytes
      FOLLOWER_POLL_MS: "50"           # follower poll interval (ms)
      CACHE_JANITOR_INTERVAL: "300" #5mins
      ALLOWED_HOSTS: ""
      DISABLE_SSL_VERIFY: "0"
      LOG_VERBOSE: "1"                       # <-- set to "0" to reduce log noise
      RESOLVE_TTL: "600"                #defaults to 600 sec if not defined, how long proxy will wait before re-resolving CDN location      
    volumes:
      - ./conf/nginx.conf:/usr/local/openresty/nginx/conf/nginx.conf:ro
      - ./conf/streamcache.conf:/etc/openresty/conf.d/streamcache.conf:ro
      #- ./cache:/var/cache/streamcache
      - /mnt/data/streamcache:/var/cache/streamcache
    command: ["/usr/local/openresty/bin/openresty", "-g", "daemon off;"]
